---
title: "Introducción - ejemplos"
author: "Felipe González"
date: Otoño 2015
output: 
  html_document: 
    theme: united
---


### Reconocimiento de dígitos

```{r, message=FALSE}
library(dplyr)
library(tidyr)
library(ggplot2)
library(ElemStatLearn)
graficar_digitos <- function(datos){
  mat_digitos <- lapply(1:nrow(datos), 
	                         function(x){ 
                            	t(matrix(as.numeric(datos[x, 2:257]), 
                            	         16, 16, byrow = T))[,16:1]
                             })
	image (z = Reduce("rbind", mat_digitos), col = terrain.colors(30))
	text(seq(0,1,1/10) + 0.05, 0.05, label = datos[, 1], cex = 1.5)
}

```

Consideramos imágenes escaneadas de dígitos escritos a mano, procesadas
a 16x16 pixeles.

```{r, fig.width=10, fig.height=3}
zip_train <- data.frame(zip.train)
muestra <- zip_train %>% sample_n(10)
graficar_digitos(muestra)
```

```{r, fig.width=10, fig.height=3}
muestra <- zip_train %>% sample_n(10)
graficar_digitos(muestra)
```

Los 16x16=256 están escritos acomodando las filas de la imagen en 
vector de 256 valores (cada renglón de `zip.train`):

```{r}
dim(zip_train)
#un renglón
x <- as.numeric(zip_train[3,2:257])
x
zip_train[3,1]
```


¿Podemos reconocer los distintos patrones de los dígitos de manera
automática? Nos gustaría poder "ver" en el espacio de dimensión 256 y reconocer
los distintos grupos que forman los distintos dígitos, si es que existe. Podemos
intentar mapear a un espacio de dimensión baja (2), intentando preservar la estructura
local de los datos. En este caso intentamos con [t-sne](https://www.youtube.com/watch?v=RJVL80Gg3lA&list=UUtXKDgv1AVoG88PLl8nGXmw):



```{r}
library(tsne)
set.seed(288022)
muestra_dig <- zip_train %>% sample_n(500)
tsne_digitos <- tsne(muestra_dig[,2:257], perplexity = 30, max_iter = 500, initial_dims = 15)
dat_tsne <- data.frame(tsne_digitos)
dat_tsne$digito <- as.character(muestra_dig$X1)
ggplot(dat_tsne, aes(x=X1, y=X2, colour=digito, label=digito)) + geom_text()
```



### Clasificación de spam


Para cada mail, en la etapa de preprocesamiento, se cuenta 
la frecuencia de ocurrencia de ciertas palabras o símbolos:


```{r}
spam.train <- read.csv(file = '../../datos/spam/spam_train.csv')
dim(spam.train)
names(spam.train) <- c("wfmake", "wfaddress", "wfall", "wf3d", "wfour",
  "wfover", "wfremove", "wfinternet", "wforder", "wfmail", 
  "wfreceive", "wfwill", "wfpeople", "wfreport", "wfaddresses", 
	"wffree", "wfbusiness", "wfemail", "wfyou", "wfcredit", "wfyour", 
	"wffont", "wf000", "wfmoney", "wfhp", "wfhpl", "wfgeorge", "wf650", 
	"wflab", "wflabs", "wftelnet", "wf857", "wfdata", "wf415", "wf85", 
	"wftechnology", "wf1999", "wfparts", "wfpm", "wfdirect", "wfcs", 
	"wfmeeting", "wforiginal", "wfproject", "wfre", "wfedu", "wftable", 
	"wfconference", "cfsc", "cfpar", "cfbrack", "cfexc", "cfdollar", 
	"cfpound", "crlaverage", "crllongest", "crltotal", "spam")
head(spam.train)
spam %>% group_by(spam) %>% tally
```
Frecuencias para las primeras 35 características, promediadas sobre
los spams y los no spams:

```{r}
frec.terminos <- spam.train %>% 
  gather(termino, frec, wfmake:crltotal) %>%
  group_by(spam, termino) %>%
  summarise(media.frec = mean(frec))
indices <- frec.terminos %>% 
  group_by(termino) %>%
  mutate(media.gral = mean(media.frec)) %>%
  mutate(indice = media.frec/media.gral) %>%
  filter(spam == 1) %>%
  select(termino, indice)
frec.terminos <- frec.terminos %>%
  left_join(indices)
```

```{r, fig.height=8}
ggplot(frec.terminos, aes(x = reorder(termino,indice), y = media.frec, colour=factor(spam))) + 
    geom_point() + coord_flip() +
    ylab("Promedio de frecuencia de ocurrencia") + scale_y_log10() 
```

¿Qué reglas de clasificación podemos usar? Esta es una regla simple: 
clasificar como spam si tiene signos de exclamación y la palabra 'free'. 
Clasificar como spam si no

 Clasificados como Spam
```{r}
regla.spam <- spam.train$cfexc > 0 & spam.train$wffree > 0
tab.1 <- table(spam.train$spam[regla.spam])
tab.1
```

Falsos positivos: 11%

```{r}
round(prop.table(tab.1),2)
```
Clasificados como No spam
```{r}
tab.2 <- table(spam.train$spam[!regla.spam])
tab.2
round(prop.table(tab.2),2)
```

Falsos negativos: 26%
Los errores son muy altos. ¿Cómo mejorar?
```

